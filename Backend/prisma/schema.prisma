generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  VENDOR
  ADMIN
  PARTNER
}

enum AdType {
  STOREFRONT
  PRODUCT_PROMOTION
  SEARCH_BOOST
}

enum AdStatus {
  PENDING
  ACTIVE
  EXPIRED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

enum ReferralStatus {
  PENDING
  COMPLETED
  CANCELLED
}

enum KYCStatus {
  PENDING
  DOCUMENTS_REVIEW
  INTERVIEW_SCHEDULED
  INTERVIEW_COMPLETED
  APPROVED
  REJECTED
}

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  email     String   @unique
  password  String
  phone     String?  @unique
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Profile fields
  profileImage String?
  bio          String?
  dateOfBirth  DateTime?
  gender       String?
  address      String?
  city         String?
  state        String?
  zipCode      String?
  country      String?

  // Password reset fields
  resetPasswordToken    String?
  resetPasswordExpires  DateTime?

  // Email verification fields
  isEmailVerified       Boolean   @default(false)
  emailVerifiedAt       DateTime?

  // KYC fields
  listingLimit      Int      @default(3)
  isKYCVerified     Boolean  @default(false)
  kycCompletedAt    DateTime?

  // Relations
  listings             Listing[]
  ads                  Ad[]
  payments             Payment[]
  vendorProfile        VendorProfile?
  favorites            Favorite[]
  savedSearches        SavedSearch[]
  PhoneVerification    PhoneVerification[]
  userPreferences      UserPreferences?
  NotificationSettings NotificationSettings?
  advertisements       Advertisement[]
  emailVerifications   EmailVerification[]
  listingViews         ListingView[]
  listingSaveEvents    ListingSaveEvent[]
  listingMessageClicks ListingMessageClick[]

  // Referral & KYC relations
  referralCode        Referral?          @relation("ReferrerUser")
  usedReferralCode    ReferralUse?       @relation("ReferredVendor")
  vendorKYC           VendorKYC?
  commissionPayments  CommissionPayment[]
  monthlyStatements   MonthlyStatement[]
  whatsappOptIn       Boolean             @default(false)
  whatsappMessageLogs WhatsAppMessageLog[]
  botNotifications    BotNotification[]
  searchLogs          SearchLog[]

  // Bot specific fields
  source              String?             @default("web") // 'web', 'mobile', 'whatsapp'
  whatsappName        String?
  whatsappVerified    Boolean             @default(false)
  lastActiveAt        DateTime?

  // Chat relations
  buyerConversations  Conversation[]     @relation("BuyerConversations")
  sellerConversations Conversation[]     @relation("SellerConversations")
  sentMessages        Message[]

  @@index([role])
}

model WhatsAppMessageLog {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     String?  @db.ObjectId
  user       User?    @relation(fields: [userId], references: [id])
  messageSid String   @unique
  status     String
  direction  String   // inbound, outbound
  body       String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId])
}

model VendorProfile {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  storeName        String
  storeDescription String?
  storeAddress     String
  businessCategory String
  coverImage       String?
  logo             String?
  website          String?
  storeAnnouncement String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Vendor verification fields
  isVerified       Boolean  @default(false)
  verificationStatus String @default("PENDING") // PENDING, APPROVED, REJECTED
  rejectionReason  String?
  verifiedAt       DateTime?
  verifiedBy       String?  @db.ObjectId // Admin user ID who verified

  userId String @unique @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])
  Ad     Ad[]

  // New relations
  businessHours BusinessHours?
  socialMedia   SocialMedia?
  storeSettings StoreSettings?

  // Listing controls
  canCreateUnlimitedListings Boolean @default(false)
  currentListingsCount       Int     @default(0)

  @@index([storeName])
  @@index([businessCategory])
}


enum RewardStatus {
  PENDING
  QUALIFIED
  APPROVED
  PAID
  REJECTED
}

enum PayoutPeriodStatus {
  OPEN
  LOCKED
  PROCESSING
  COMPLETED
}

enum StatementStatus {
  DRAFT
  APPROVED
  PAID
  REJECTED
}

enum ClickStatus {
  STARTED
  QUALIFIED
  FLAGGED
}

model Referral {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  code         String   @unique
  userId       String   @unique @db.ObjectId
  user         User     @relation("ReferrerUser", fields: [userId], references: [id])

  totalReferrals       Int     @default(0)
  successfulReferrals  Int     @default(0)
  totalClicks          Int     @default(0) // New: distinct from totalReferrals
  totalEarnings        Float   @default(0)
  pendingEarnings      Float   @default(0) // New: accrues here before statement

  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  referredVendors ReferralUse[]
  clicks          ReferralClick[]
}

model ReferralUse {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  referralId   String   @db.ObjectId
  referral     Referral @relation(fields: [referralId], references: [id])

  vendorId     String   @unique @db.ObjectId
  vendor       User     @relation("ReferredVendor", fields: [vendorId], references: [id])

  // Reward Milestones
  signupRewardAmount    Float    @default(25)
  signupRewardStatus    RewardStatus @default(PENDING) // PENDING, FLAGGED, APPROVED, PAID
  
  listingRewardAmount   Float    @default(25)
  listingRewardStatus   RewardStatus @default(PENDING)
  
  firstListingId        String?  @db.ObjectId // Link to the listing that triggered the reward

  // Meta
  isFraud               Boolean  @default(false)

  // Old fields for backward compatibility/migration (if needed, but we can deprecate them)
  status       ReferralStatus @default(PENDING)
  commission   Float    @default(0) // Deprecated in favor of specific rewards? Keeping for safety
  commissionPaid Boolean @default(false)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([referralId, vendorId])
}

model ReferralClick {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  referralId   String   @db.ObjectId
  referral     Referral @relation(fields: [referralId], references: [id])
  
  fingerprint  String   // Hash of IP + UserAgent + DailySalt
  ipAddress    String?
  userAgent    String?
  
  status       ClickStatus @default(STARTED) // STARTED, QUALIFIED, FLAGGED
  rewardAmount Float       @default(15)
  
  clickedAt    DateTime @default(now())
  qualifiedAt  DateTime? // When they passed the bounce check
  
  @@index([referralId, fingerprint])
  @@index([clickedAt]) 
}

model PayoutPeriod {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  month     Int      // e.g. 1
  year      Int      // e.g. 2026
  
  startDate DateTime
  endDate   DateTime
  
  status    PayoutPeriodStatus @default(OPEN) // OPEN, LOCKED, PROCESSING, COMPLETED
  
  totalPayoutAmount Float @default(0)
  totalPartnersPaid Int   @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  statements MonthlyStatement[]
  
  @@unique([month, year])
}

model MonthlyStatement {
  id              String       @id @default(auto()) @map("_id") @db.ObjectId
  payoutPeriodId  String       @db.ObjectId
  payoutPeriod    PayoutPeriod @relation(fields: [payoutPeriodId], references: [id])
  
  userId          String       @db.ObjectId // The Partner
  user            User         @relation(fields: [userId], references: [id])
  
  // Stats for this month
  vendorsReferredCount Int @default(0)
  vendorsActivatedCount Int @default(0) // Completed both steps
  clicksCount           Int @default(0)
  
  // Financials
  totalEarned     Float   @default(0) // Sum of approved rewards
  status          StatementStatus @default(DRAFT)
  
  paidAt          DateTime?
  paymentReference String? // Bank transfer ref
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([payoutPeriodId, userId])
}

model VendorKYC {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  vendorId     String   @unique @db.ObjectId
  vendor       User     @relation(fields: [vendorId], references: [id])

  // Business Socials
  tiktokHandle    String?
  instagramHandle String?
  facebookPage    String?
  twitterHandle   String?
  otherSocial     String?

  // Business Registration
  cacNumber       String?  // Corporate Affairs Commission number
  documentUrl     String?  // URL to uploaded CAC certificate or student portal screenshot
  documentType    String?  // "CAC_CERTIFICATE" or "STUDENT_PORTAL"

  // Interview Details
  interviewScheduled DateTime?
  interviewCompleted DateTime?
  interviewNotes     String?
  interviewedBy      String?   @db.ObjectId

  // KYC Status
  status          KYCStatus @default(PENDING)
  rejectionReason String?

  // Payment Info
  signupFee        Float
  hasReferral      Boolean       @default(false)
  paymentStatus    PaymentStatus @default(PENDING)
  paymentReference String?
  paidAt           DateTime?

  // Validity & renewals
  validUntil    DateTime?
  renewalCount  Int       @default(0)

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([status])
}

model CommissionPayment {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  referralUseId   String   @db.ObjectId
  userId          String   @db.ObjectId
  user            User     @relation(fields: [userId], references: [id])

  amount          Float
  paymentMethod   String?
  paymentReference String?
  status          PaymentStatus @default(PENDING)

  paidAt          DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
  @@index([status])
}

model Category {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String   @unique
  slug      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  listings Listing[]
}

model Listing {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String
  price       Float
  images      String[]
  location    String?
  condition   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sellerId String @db.ObjectId
  seller   User   @relation(fields: [sellerId], references: [id])

  categoryId String?   @db.ObjectId
  category   Category? @relation(fields: [categoryId], references: [id])

  isActive Boolean @default(true)

  // ðŸ‘‡ add this line for relation with Favorite
  favorites  Favorite[]
  Ad         Ad[]
  boostScore Int        @default(0)
  ListingView        ListingView[]
  ListingSaveEvent   ListingSaveEvent[]
  ListingMessageClick ListingMessageClick[]
  conversations      Conversation[]

  // WhatsApp specific
  whatsappEnabled     Boolean             @default(true)
  whatsappSearchTerms String[]            @default([])
  brand               String?
  stock               Int                 @default(1)

  @@index([isActive, boostScore, createdAt])
  @@index([categoryId, isActive, boostScore, createdAt])
  @@index([sellerId, isActive, boostScore, createdAt])
  @@index([isActive, price])
  @@index([sellerId])
}

model PhoneVerification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  phone     String
  code      String
  expiresAt DateTime
  attempts  Int      @default(0)
  createdAt DateTime @default(now())
  verified  Boolean  @default(false)

  @@index([userId])
  @@index([phone])
}

model Favorite {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  listingId String   @db.ObjectId
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id])
  listing Listing @relation(fields: [listingId], references: [id])

  @@unique([userId, listingId])
  @@index([userId])
}

model SavedSearch {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  query     Json
  label     String?
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([userId])
}

model AdPlan {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  adType    AdType
  price     Int // in Naira
  duration  Int // in days
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  ads Ad[]
}

model Ad {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  type      AdType
  status    AdStatus @default(PENDING)
  startDate DateTime
  endDate   DateTime

  vendorId String @db.ObjectId
  vendor   User   @relation(fields: [vendorId], references: [id])

  storeId String?        @db.ObjectId
  store   VendorProfile? @relation(fields: [storeId], references: [id])

  productId String?  @db.ObjectId
  product   Listing? @relation(fields: [productId], references: [id])

  appliesToAllProducts Boolean? @default(false)

  paymentStatus PaymentStatus @default(PENDING)
  amount        Float
  transactionId String? // Paystack/Stripe ref

  createdAt DateTime  @default(now())
  AdPlan    AdPlan?   @relation(fields: [adPlanId], references: [id])
  adPlanId  String?   @db.ObjectId
  Payment   Payment[]
}

model Payment {
  id        String        @id @default(auto()) @map("_id") @db.ObjectId
  reference String        @unique
  amount    Int
  status    PaymentStatus @default(PENDING)
  createdAt DateTime      @default(now())

  adId String @db.ObjectId
  ad   Ad     @relation(fields: [adId], references: [id])

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])
}

// New models for comprehensive settings
model BusinessHours {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  monday    Json // { open: "09:00", close: "18:00", closed: false }
  tuesday   Json // { open: "09:00", close: "18:00", closed: false }
  wednesday Json // { open: "09:00", close: "18:00", closed: false }
  thursday  Json // { open: "09:00", close: "18:00", closed: false }
  friday    Json // { open: "09:00", close: "18:00", closed: false }
  saturday  Json // { open: "10:00", close: "16:00", closed: false }
  sunday    Json // { open: "12:00", close: "16:00", closed: true }
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  vendorProfileId String        @unique @db.ObjectId
  vendorProfile   VendorProfile @relation(fields: [vendorProfileId], references: [id])
}

model SocialMedia {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  facebook  String?
  twitter   String?
  instagram String?
  linkedin  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  vendorProfileId String        @unique @db.ObjectId
  vendorProfile   VendorProfile @relation(fields: [vendorProfileId], references: [id])
}

model StoreSettings {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  autoSave    Boolean  @default(true)
  emailDigest Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  vendorProfileId String        @unique @db.ObjectId
  vendorProfile   VendorProfile @relation(fields: [vendorProfileId], references: [id])
}

model UserPreferences {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  language   String   @default("English")
  timezone   String   @default("Africa/Lagos")
  currency   String   @default("NGN")
  dateFormat String   @default("DD/MM/YYYY")
  theme      String   @default("light") // light, dark, auto
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  userId String @unique @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])
}

model NotificationSettings {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  // Order notifications
  orderUpdates         Boolean @default(true)
  newMessages          Boolean @default(true)
  lowStockAlerts       Boolean @default(true)
  paymentNotifications Boolean @default(true)

  // Marketing & reports
  marketingEmails Boolean @default(false)
  weeklyReports   Boolean @default(true)
  monthlyReports  Boolean @default(true)

  // Security notifications
  emailNotifications Boolean @default(true)
  smsNotifications   Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String @unique @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])
}

// Password reset verification codes
model PasswordReset {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  email     String
  code      String   // 6-digit verification code
  expiresAt DateTime // When the code expires
  used      Boolean  @default(false) // Whether the code has been used
  createdAt DateTime @default(now())
  
  // Index for quick lookups
  @@index([email, code])
  @@index([expiresAt])
}

// Email verification tokens
model EmailVerification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique // Unique verification token
  expiresAt DateTime // Token expiration (24 hours)
  verified  Boolean  @default(false) // Whether token has been used
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([expiresAt])
}

// Admin-managed selling locations for vendors
model Address {
  id      String  @id @default(auto()) @map("_id") @db.ObjectId
  name    String  @unique
  active  Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Advertisement management system
model Advertisement {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  imageUrl    String   // URL to the advertisement image
  targetUrl   String?  // Optional URL to redirect when ad is clicked
  duration    Int      // Duration in days (3, 7, 15, or 31)
  startDate   DateTime @default(now())
  expiryDate  DateTime // Calculated from startDate + duration
  isActive    Boolean  @default(true)
  impressions Int      @default(0) // Track how many times ad was shown
  clicks      Int      @default(0) // Track how many times ad was clicked
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Admin who created the ad
  createdById String   @db.ObjectId
  createdBy   User     @relation(fields: [createdById], references: [id])
  
  @@index([isActive, expiryDate])
  @@index([startDate])
}

// Listing analytics tracking
model ListingView {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  listingId String   @db.ObjectId
  listing   Listing  @relation(fields: [listingId], references: [id])
  userId    String?  @db.ObjectId
  user      User?    @relation(fields: [userId], references: [id])
  sessionId String?
  viewedAt  DateTime @default(now())

  @@index([listingId])
  @@index([userId])
}

model ListingSaveEvent {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  listingId String   @db.ObjectId
  listing   Listing  @relation(fields: [listingId], references: [id])
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  savedAt   DateTime @default(now())

  @@index([listingId])
  @@index([userId])
}

model ListingMessageClick {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  listingId String   @db.ObjectId
  listing   Listing  @relation(fields: [listingId], references: [id])
  userId    String?  @db.ObjectId
  user      User?    @relation(fields: [userId], references: [id])
  clickedAt DateTime @default(now())

  @@index([listingId])
  @@index([userId])
}

model FeatureFlag {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  key         String   @unique
  isEnabled   Boolean  @default(false)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SystemSettings {
  id                  String   @id @default(auto()) @map("_id") @db.ObjectId
  signupRewardAmount  Float    @default(25)
  listingRewardAmount Float    @default(25)
  clickRewardAmount   Float    @default(15)
  minimumPayoutAmount Float    @default(1000)
  updatedAt           DateTime @updatedAt
}

// Chat System Models
model Conversation {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  
  // Optional: link to specific listing (null for general vendor chat)
  listingId     String?   @db.ObjectId
  listing       Listing?  @relation(fields: [listingId], references: [id])
  
  // Participants
  buyerId       String    @db.ObjectId
  buyer         User      @relation("BuyerConversations", fields: [buyerId], references: [id])
  
  sellerId      String    @db.ObjectId
  seller        User      @relation("SellerConversations", fields: [sellerId], references: [id])
  
  // Metadata
  lastMessageAt DateTime  @default(now())
  lastMessagePreview String? @db.String // Cache for inbox list view
  
  // Status
  isActive      Boolean   @default(true)
  isArchived    Boolean   @default(false)
  
  // Timestamps
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  messages      Message[]
  reports       ConversationReport[]
  
  // Ensure unique conversation per buyer-seller-listing combo
  @@unique([buyerId, sellerId, listingId])
  @@index([buyerId, isActive])
  @@index([sellerId, isActive])
  @@index([listingId])
  @@index([lastMessageAt])
}

model Message {
  id             String       @id @default(auto()) @map("_id") @db.ObjectId
  conversationId String       @db.ObjectId
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  // Sender
  senderId       String       @db.ObjectId
  sender         User         @relation(fields: [senderId], references: [id])
  senderType     String       // "BUYER" | "SELLER" for quick reference
  
  // Content
  messageType    String       @default("TEXT") // "TEXT" | "IMAGE"
  content        String?      @db.String // Text content (null for image-only)
  imageUrl       String?      // URL for image messages
  
  // Read status
  isRead         Boolean      @default(false)
  readAt         DateTime?
  
  // Email notification tracking
  emailSent      Boolean      @default(false)
  emailSentAt    DateTime?
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  @@index([conversationId, createdAt])
  @@index([senderId])
  @@index([isRead])
  @@index([createdAt]) // For 30-day cleanup
}

model ConversationReport {
  id             String       @id @default(auto()) @map("_id") @db.ObjectId
  conversationId String       @db.ObjectId
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  reporterId     String       @db.ObjectId // User who reported
  reason         String       // "SPAM" | "HARASSMENT" | "FRAUD" | "INAPPROPRIATE" | "OTHER"
  details        String?      @db.String
  status         String       @default("PENDING") // "PENDING" | "REVIEWED" | "RESOLVED" | "DISMISSED"
  reviewedBy     String?      @db.ObjectId // Admin who reviewed
  reviewedAt     DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  @@index([conversationId])
  @@index([status])
  @@index([createdAt])
}

model SearchLog {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  userId       String?  @db.ObjectId
  user         User?    @relation(fields: [userId], references: [id])
  query        String
  intent       String?  // 'product_search', 'support', etc.
  entities     Json?    // Extracted entities (category, color, price, etc.)
  resultsCount Int      @default(0)
  clickedProductIds String[] @db.ObjectId
  source       String   @default("whatsapp")
  createdAt    DateTime @default(now())

  @@index([createdAt])
  @@index([userId])
}

model BotNotification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  type      String   // 'new_message', 'low_stock'
  title     String
  message   String
  sentVia   String   @default("whatsapp") // 'whatsapp', 'email', 'push', 'sms'
  isRead    Boolean  @default(false)
  metadata  Json?
  sentAt    DateTime @default(now())
  readAt    DateTime?

  @@index([userId])
  @@index([sentAt])
}
